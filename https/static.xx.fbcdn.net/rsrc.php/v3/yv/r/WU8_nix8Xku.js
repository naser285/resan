if (self.CavalryLogger) { CavalryLogger.start_js(["ACiSl"]); }

__d("ViewableImpressionEventHandler",["DataAttributeUtils","FullViewLogger","ViewabilityDebugLogger","ViewabilityDurationSegmentLogger","ViewableImpressionDurationLogger","ViewableImpressionHeatmapLogger","ViewableImpressionTracker","VisibilityTracking"],(function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){"use strict";__p&&__p();var o,p,q=1;o=babelHelpers.inherits(a,n);p=o&&o.prototype;a.prototype.extraInit=function(){this.impressionTrackers={}};a.prototype.getDataFromConfig=function(a){p.getDataFromConfig.call(this,a),this.doHeatmapLogging=a.doHeatmapLogging,this.heatmapLoggingDurationMS=a.heatmapLoggingDurationMS,a.impressionURL=a.impressionURL!==undefined?a.impressionURL:"/xti.php",a.nonviewableEnabled=a.nonviewableEnabled!==undefined?a.nonviewableEnabled:!1};a.prototype.getImpressionTracking=function(a){__p&&__p();var b=this.getElementID(a),c=this.impressionTrackers[b];if(!c){var d=babelHelpers["extends"]({},this.getConfigFromElement(a),this.config);c=new m(b,a,d);this.impressionTrackers[b]=c;d.log_impression_duration&&k.logFromViewableImpressionTracker(c);this.doHeatmapLogging&&l.logFromViewableImpressionTracker(c,this.heatmapLoggingDurationMS);d.should_log_full_views&&h.logFromViewableImpressionTracker(c);d.should_log_viewability_duration&&j.logFromViewableImpressionTracker(c);d.should_log_debug_duration&&i.logFromViewableImpressionTracker(c)}return c};a.prototype.handleEvent=function(a,event){var b=this.getImpressionTracking(a);if(!b)return;if(event.name==="visible")b.onVisible(event),this.visibleElementInfo[b.getID()]||(this.visibleElementInfo[b.getID()]={elem:a});else if(event.name==="hidden"){a=b.getConfig();event.cause==="default"||a.log_visibility_hidden_when_browser_inactive&&event.cause==="browser"?(b.onHidden(),delete this.visibleElementInfo[b.getID()]):event.cause==="removed"&&(b.onRemoved(),delete this.visibleElementInfo[b.getID()],delete this.impressionTrackers[b.getID()])}};a.prototype.isInstreamAdStoryElement=function(a){a=babelHelpers["extends"]({},this.getConfigFromElement(a),this.config);return!!a.is_instream_story};a.prototype.getConfigFromElement=function(a){return JSON.parse(g.getDataAttribute(a,"data-xt-vimp"))};a.prototype.getElementID=function(a){a.getAttribute("id")||a.setAttribute("id","xt_uniq_"+q++);return a.getAttribute("id")};function a(){o.apply(this,arguments)}e.exports=a}),null);
